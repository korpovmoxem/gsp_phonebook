<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>Телефонный справочник</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link id="favicon" rel="icon" type="image/x-icon" href="{{ url_for('static', path='/content/favicon.ico') }}">
    <link href="{{ url_for('static', path='/style.css') }}" rel=stylesheet>
    <script src="/get_organization_tree"></script>
  </head>
  <body>
    <script>
  async function getOrganization() {
  try {
    const response = await fetch('get_organization_tree');
    const data = await response.json();
    const newData = JSON.parse(data)
    renderOrganization(newData);
  } catch (err) {
    console.log(err);
  }
}
getOrganization();

function renderOrganization(jsonData) {
  const menuContainer = document.querySelector(".menu__list");
  jsonData.forEach((item) => {
    const menuItems = createMenuItems(item.Name, item.Children);
    menuContainer.insertAdjacentHTML("beforeend", menuItems);
  });
}

function createMenuItems(name, children) {
  let html = `<li class="myMainClass">
      <span class="menu__items">${name}</span>
      <ul class="menu__item">`;
  children.forEach((value) => {
    const hasChildren =
      Array.isArray(value.Children) && value.Children.length > 0;
    html += createMenuItem(hasChildren, value);
  });

  html += `</ul>
  </li>`;

  return html;
}

function createMenuItem(hasChildren, value) {
  let html = "";

  if (hasChildren) {
    html += `<li>
          <span class="menu__items"><a href='/?&search_text={{ search_text }}&organization=${value.Inn}&department=${value.ID}'>${value.Name}</a></span>
          <ul class="menu__item">`;

    value.Children.forEach((child) => {
      if (Array.isArray(child.Children) && child.Children.length === 0) {
        html += `<li><a href='/?&search_text={{ search_text }}&organization=${child.Inn}&department=${child.ID}'>${child.Name}</a></li>`;
      }
      if (Array.isArray(child.Children) && child.Children.length > 0) {
        html += `<li><span class="menu__items"><a href='/?&search_text={{ search_text }}&organization=${
          child.Inn
        }&department=${child.ID}'>${child.Name}</a></span>
              <ul class="menu__item">
              ${createChildItems(child.Children)}
              </ul></li>`;
      }
    });

    html += `</ul></li>`;
  } else {
    html += `<li><a href='/?&search_text={{ search_text }}&organization=${value.Inn}&department=${value.ID}'>${value.Name}</a></li>`;
  }
  return html;
}

function createChildItems(children) {
  let html = "";
  children.forEach((child) => {
    if (Array.isArray(child.Children) && child.Children.length === 0) {
      html += `<li><a href='/?&search_text={{ search_text }}&organization=${child.Inn}&department=${child.ID}'>${child.Name}</a></li>`;
    }
    if (Array.isArray(child.Children) && child.Children.length > 0) {
      html += `<li><span class="menu__items"><a href='/?&search_text={{ search_text }}&organization=${
        child.Inn
      }&department=${child.ID}'>${child.Name}</a></span>
      <ul class="menu__item">
      ${createChildItems(child.Children)}
      </ul></li>`;
    }
  });
  return html;
}
    </script>
    <!-- Предупреждение в шапке сайта -->
      <div class="content-alert">
        <div class="container">
          <div class="content">
            Уважаемые коллеги! Данный справочник работает в тестовом режиме. Если у вас есть предложения, вы нашли ошибку или хотели бы заменить фото, то направляйте письма на адрес <a class="content__link" href="mailto:phonebook@gsprom.ru">phonebook@gsprom.ru</a>
          </div>
        </div>
      </div>

    <!-- Эффект при наведении на ссылки -->
      <div class="follow-cursor"></div>
      
    <!-- Шапка сайта: Баннер и Заголовок -->
      <section class="banner">
      <div class="banner__content">
        <h1 class="header-title-h1">Телефонный справочник</h1>
      </div>
      <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" viewbox="0 25 160 40" class="waves">
        <defs><path id="wave" d="M-150 53c30.77 0 59.538-20 90-20 31.077 0 60.256 20 90 20 30.77 0 59.23-20 90-20 30.77 0 59.23 20 90 20v20h-360z"/></defs>
        <g>
          <use xlink:href="#wave" x="50" y="0" fill="#7986cb"/>
          <use xlink:href="#wave" x="50" y="2" fill="#5c6bc0"/>
          <use xlink:href="#wave" x="50" y="4" fill="#ffffff"/>
        </g>
      </svg>
      </section>

    <!-- Хедер, когда убираем анимацию -->
      <div class="header hidden">
        <div class="container">
          <h1 class="header-title-h1">Телефонный справочник</h1>
        </div>
      </div>
    <!-- Навигационное меню сайта: Ссылка на Газстройпром и Переключатель темной и светлой темы -->
      <nav class="nav">
      <div class="container">
        <div class="nav-row">
          <ul class="menu__nav-item">
            <li class="menu__nav-list">
              <a href="https://intranet.gsprom.ru/" class="menu__link"><img class="img__card" src="{{ url_for('static', path='/content/Логотип_доп_горизнтл_короткий_чб.png') }}" alt=""></a>
            </li>
          </ul>
          <div class="button__toggle">
            <button class="dark-mode-btn">
              <img src="{{ url_for('static', path='/content/sun.svg') }}" alt="Light mode" class="dark-mode-btn__icon"/>
              <img src="{{ url_for('static', path='/content/moon.svg') }}" alt="Dark mode" class="dark-mode-btn__icon"/>
            </button>
            <label class="toggle">
              <input class="toggle-checkbox switch" type="checkbox">
              <div class="toggle-switch">
                <img src="{{ url_for('static', path='/content/winter.svg') }}" alt="cap" class="cap__icon"/>
              </div>
            </label>
          </div>
        </div>
      </div>
      </nav>
      
      <!-- Скрипт для изменения фона -->
      <script>
        let banner = document.querySelector('.banner') // Банер на 27 строке
        let header = document.querySelector('.header')// Хедер, который появляется вместо банера на 42 строке
        let switchEl = document.querySelector('.switch'); // Инпут на 61
        
        if(localStorage.getItem('switchState')) {
            switchEl.checked = JSON.parse(localStorage.getItem('switchState'));
        }
        switchEl.addEventListener('change', () => {
            const { checked } = switchEl;
            localStorage.setItem('switchState', checked);
        });

        switchEl.addEventListener("click", () => {
            const bannerHidden = localStorage.getItem("toggleBanner");
            const headerVisible = localStorage.getItem("toggleHeader");
            if (bannerHidden) {
              banner.classList.remove("hidden");
              localStorage.removeItem("toggleBanner");
            } else {
              banner.classList.add("hidden");
              localStorage.setItem("toggleBanner", "true");
            }

            if (headerVisible) {
              header.classList.add("hidden");
              localStorage.removeItem("toggleHeader");
            } else {
              header.classList.remove("hidden");
              localStorage.setItem("toggleHeader", "true");
            }
            
          });

          if(localStorage.getItem('toggleBanner')) 
        { 
          document.querySelector('.header').classList.remove('hidden'); 
          document.querySelector('.banner').classList.add('hidden'); 
        }
      </script>

    <!-- Скрипт для темной и светлой темы -->
      <script>
      const btnDarkMode = document.querySelector(".dark-mode-btn");
        // 1. Проверка темной темы на уровне системных настроек
        if (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ) {
          btnDarkMode.classList.add("dark-mode-btn--active");
          document.body.classList.add("dark");
        }
        
        // 2. Проверка темной темы в localStorage
        if (localStorage.getItem('darkMode') === 'dark') {
          btnDarkMode.classList.add("dark-mode-btn--active");
          document.body.classList.add("dark");
        } else if (localStorage.getItem("darkMode") === "light") {
          btnDarkMode.classList.remove("dark-mode-btn--active");
          document.body.classList.remove("dark");
        }
        
        // Если меняются системные настройки, меняем тему
        window
            .matchMedia("(prefers-color-scheme: dark)")
            .addEventListener("change", (event) => {
              const newColorScheme = event.matches ? "dark" : "light";
        
              if (newColorScheme === "dark") {
                btnDarkMode.classList.add("dark-mode-btn--active");
                document.body.classList.add("dark");
                localStorage.setItem("darkMode", "dark");
              } else {
                btnDarkMode.classList.remove("dark-mode-btn--active");
                document.body.classList.remove("dark");
                localStorage.setItem("darkMode", "light");
              }
            });
        
        // Включение ночного режима по кнопке
        btnDarkMode.onclick = function () {
          btnDarkMode.classList.toggle("dark-mode-btn--active");
          const isDark = document.body.classList.toggle("dark");
        
          if (isDark) {
            localStorage.setItem("darkMode", "dark");
          } else {
            localStorage.setItem("darkMode", "light");
          }
        };
      </script>

    <!-- Контейнер в котором находится структура сайта таблица и раскрывающийся список -->
      <div class="container">
    <div class='bodybody'>
    <!-- Кнопка для плавного скрола -->
    <button onclick="topFunction()" id="button_scroll_up" title="Go to top">▲</button>

    <!-- Скрипт для плавгного скорола вверх сайта при нажатии на кнопку -->
    <script>
        // When the user scrolls down 20px from the top of the document, show the button
        window.onscroll = function() {scrollFunction()};

        function scrollFunction() {
          if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("button_scroll_up").style.display = "block";
          } else {
            document.getElementById("button_scroll_up").style.display = "none";
          }
        }

        // When the user clicks on the button, scroll to the top of the document
          function topFunction() {
          document.body.scrollTop = 0; // For Safari
          document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
        }
    </script>
    
    <!-- Поисковая строка сотрудников и кнопка "Искать" -->
    <form  method="get" class='search_args'>
        <!-- <select disabled class="form-select" id="search_filter" aria-label="Фильтр" style="width: 250px; border-color: #252526; border-width: 1px; border-radius: 5px 0 0 5px; visibility: hidden">
        <option selected value="all">{{ search_filter }}</option>
        <option value="name">ФИО</option>
        <option value="job_title">Должность</option>
        <option value="phone_code">Внутренний номер</option>
        <option value="work_phone">Рабочий телефон</option>
        <option value="email">Email</option>
        <option value="company">Компания</option>
        <option value="department">Отдел</option>
        </select> -->
        <input  type='search' id='search_text' value='{{ search_text }}' class='input-line inputBox' name=search_text
        title='Поиск осуществляется одновременно по всем атрибутам (ФИО, отдел, телефон и тд.). Для сброса результатов поиска - нажмите "Искать" с пустым полем' data-toggle="tooltip" data-bs-placement="top">
        <input id='search' class='btn btn-primary' type='submit' value='Искать'>
        <span class="newText"></span>
        <!-- Копирование емаил адресов  -->
        <div class="container__icon"  title='Скопировать в буфер email найденных сотрудников' data-toggle="tooltip" data-bs-placement="top">  
          <svg class="svg__mail" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            width="20px" height="20px" viewBox="0 0 512 512" xml:space="preserve">
         <g>
           <path d="M448,64H64C28.656,64,0,92.656,0,128v256c0,35.344,28.656,64,64,64h384c35.344,0,64-28.656,64-64V128
             C512,92.656,483.344,64,448,64z M342.656,234.781l135.469-116.094c0.938,3,1.875,6,1.875,9.313v256
             c0,2.219-0.844,4.188-1.281,6.281L342.656,234.781z M448,96c2.125,0,4,0.813,6,1.219L256,266.938L58,97.219
             C60,96.813,61.875,96,64,96H448z M33.266,390.25C32.828,388.156,32,386.219,32,384V128c0-3.313,0.953-6.313,1.891-9.313
             L169.313,234.75L33.266,390.25z M64,416c-3.234,0-6.172-0.938-9.125-1.844l138.75-158.563l51.969,44.531
             C248.578,302.719,252.297,304,256,304s7.422-1.281,10.406-3.875l51.969-44.531l138.75,158.563C454.188,415.062,451.25,416,448,416
             H64z"/>
          </svg>
          <svg class="svg__search" id="Capa_1" style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="20px" height="20px">
        <g><path class="st0" d="M453.8,128.9c0-0.1,0-0.1-0.1-0.2c-0.5-1.2-1.2-2.2-2-3.2c0,0,0-0.1-0.1-0.1l-43.8-45.6V43.2   c0-23-18.7-41.7-41.7-41.7H100.2c-23.6,0-42.7,19.2-42.7,42.7v386.5c0,23.6,19.2,42.7,42.7,42.7h4.2c1.9,21.8,20.3,39,42.5,39   h264.8c23.6,0,42.7-19.2,42.7-42.7V132.6C454.5,131.3,454.2,130,453.8,128.9z M375.9,76.8l43.7,45.4h-43.7V76.8z M78.4,430.8V44.2   c0-12.1,9.8-21.9,21.9-21.9h265.9c11.5,0,20.8,9.3,20.8,20.8v15L373,43.7c0,0-0.1,0-0.1-0.1c-0.3-0.3-0.7-0.6-1-0.9   c-0.2-0.1-0.3-0.3-0.5-0.4c-0.5-0.4-1.1-0.7-1.7-0.9c0,0,0,0-0.1,0c-1.3-0.5-2.6-0.8-4.1-0.8H147c-23.6,0-42.7,19.2-42.7,42.7   v369.4h-4C88.2,452.6,78.4,442.8,78.4,430.8z M411.8,491.6H147c-12.1,0-21.9-9.8-21.9-21.9V83.2c0-12.1,9.8-21.9,21.9-21.9h208   v71.3c0,5.8,4.7,10.4,10.4,10.4h68.2v326.7C433.6,481.8,423.8,491.6,411.8,491.6z"/><path class="st0" d="M292.7,143.1h19.7c5.8,0,10.4-4.7,10.4-10.4c0-5.8-4.7-10.4-10.4-10.4h-19.7c-5.8,0-10.4,4.7-10.4,10.4   C282.2,138.4,286.9,143.1,292.7,143.1z"/><path class="st0" d="M170.3,143.1h65.8c5.8,0,10.4-4.7,10.4-10.4c0-5.8-4.7-10.4-10.4-10.4h-65.8c-5.8,0-10.4,4.7-10.4,10.4   C159.8,138.4,164.5,143.1,170.3,143.1z"/><path class="st0" d="M380.8,387.1H236.1c-5.8,0-10.4,4.7-10.4,10.4s4.7,10.4,10.4,10.4h144.7c5.8,0,10.4-4.7,10.4-10.4   S386.6,387.1,380.8,387.1z"/><path class="st0" d="M195.8,387.1h-25.5c-5.8,0-10.4,4.7-10.4,10.4s4.7,10.4,10.4,10.4h25.5c5.8,0,10.4-4.7,10.4-10.4   S201.6,387.1,195.8,387.1z"/><path class="st0" d="M380.8,321.9h-39.1c-5.8,0-10.4,4.7-10.4,10.4s4.7,10.4,10.4,10.4h39.1c5.8,0,10.4-4.7,10.4-10.4   S386.6,321.9,380.8,321.9z"/><path class="st0" d="M170.3,342.8h115.4c5.8,0,10.4-4.7,10.4-10.4s-4.7-10.4-10.4-10.4H170.3c-5.8,0-10.4,4.7-10.4,10.4   S164.5,342.8,170.3,342.8z"/><path class="st0" d="M380.8,256.6h-78.3c-5.8,0-10.4,4.7-10.4,10.4s4.7,10.4,10.4,10.4h78.3c5.8,0,10.4-4.7,10.4-10.4   S386.6,256.6,380.8,256.6z"/><path class="st0" d="M170.3,277.5H250c5.8,0,10.4-4.7,10.4-10.4s-4.7-10.4-10.4-10.4h-79.8c-5.8,0-10.4,4.7-10.4,10.4   S164.5,277.5,170.3,277.5z"/><path class="st0" d="M380.8,189.4H236.1c-5.8,0-10.4,4.7-10.4,10.4c0,5.8,4.7,10.4,10.4,10.4h144.7c5.8,0,10.4-4.7,10.4-10.4   C391.2,194.1,386.6,189.4,380.8,189.4z"/><path class="st0" d="M170.3,210.3h18.8c5.8,0,10.4-4.7,10.4-10.4c0-5.8-4.7-10.4-10.4-10.4h-18.8c-5.8,0-10.4,4.7-10.4,10.4   C159.8,205.6,164.5,210.3,170.3,210.3z"/></g>
          </svg>
        </div>

    </form>


    <!-- Раскрывающийся список филиалов и Таблица с пользователями телефонного справочник  и бутсраповский класс с колонками-->
      <div class="row row-cols-2">

        <!-- Раскрывающийся список филиалов и бутсраповский класс с колонками-->
        <div class="col-sm-4">

            <!-- Раскрывающийся список филиалов -->
          <form method="post" class='department_structure'>
          <div class="content-menu">
          <div class="menu content-hidden">
            <button type="button" class="btn-menu" id="toggleButton">Свернуть</button>
              <ul class="menu__list">
              </ul>
          </div>
        </div>
          </form>

          <!-- Скрипт для раскрывающегося списка филиалов и кнопки "Свернуть" + Появление теста с организацией и департаментом -->
          <!-- Появление теста с организацией и департаментом  -->
          <script>
            // Убираем надпись через крестик при нажатии
           document.querySelector('.newText').addEventListener('click', () => {
            document.querySelector('.newText').style.display = 'none';
            localStorage.removeItem('myText');
           })

            // Убираем надпись при нажатии кнопки "Искать"
            // document.querySelector('.btn ').addEventListener('click', () => {
            //   localStorage.removeItem('myText');
            // })

            // Добавляем надпись при нажатии на ссылку без плюса
            document.querySelectorAll('.menu__item > li > a').forEach((item) => {
                item.addEventListener('click', function (e) {
                    let stroke = [];
                    let current = item.parentNode
                    while (current.className != 'myMainClass') {
                        if (current.nodeName == 'UL') {
                            stroke.push(current.previousElementSibling.textContent);
                        }
                        current = current.parentNode;

                        //Сохранение данных после перезагрузки страницы
                        localStorage.setItem('myText', 'Поиск по: ' + stroke.reverse().join(' -> ') + ' -> ' + item.textContent);
                        localStorage.getItem('myText');
                    }
                    document.querySelector('.newText').innerText = 'Поиск по: ' + stroke.join(' -> ') + ' -> ' + item.textContent ;
                    document.querySelector('.newText').style.display = 'flex';

                })
            })

            // Добавляем надпись при нажатии на ссылку с плюсом
            document.querySelectorAll('.menu__item > li > span > a').forEach((item) => {
                item.addEventListener('click', function (e) {
                    let stroke = [];
                    let current = item.parentNode
                    while (current.className != 'myMainClass') {
                        if (current.nodeName == 'UL') {
                            stroke.push(current.previousElementSibling.textContent);
                        }
                        current = current.parentNode;

                        //Сохранение данных после перезагрузки страницы
                        localStorage.setItem('myText', 'Поиск по: ' + stroke.reverse().join(' -> ') + ' -> ' + item.textContent);
                        localStorage.getItem('myText');
                    }
                    document.querySelector('.newText').innerText = 'Поиск по: ' + stroke.join(' -> ') + ' -> ' + item.textContent ;
                    document.querySelector('.newText').style.display = 'flex';

                })
            })

            // Добавляем надпись при нажатии на ссылку с плюсом в другой структуре
            document.querySelectorAll('.menu__item > span > a').forEach((item) => {
                item.addEventListener('click', function (e) {
                    let stroke = [];
                    let current = item.parentNode
                    while (current.className != 'myMainClass') {
                        if (current.nodeName == 'UL') {
                            stroke.push(current.previousElementSibling.textContent);
                        }
                        current = current.parentNode;

                        //Сохранение данных после перезагрузки страницы
                        localStorage.setItem('myText', 'Поиск по: ' + stroke.reverse().join(' -> ') + ' -> ' + item.textContent);
                        localStorage.getItem('myText');
                    }
                    document.querySelector('.newText').innerText = 'Поиск по: ' + stroke.join(' -> ') + ' -> ' + item.textContent ;
                    document.querySelector('.newText').style.display = 'flex';

                })
            })


          // Вывод данных после перезагрузки страницы
          if(localStorage.getItem('myText') !== null)
          {
              document.querySelector('.newText').innerText = localStorage.getItem('myText');
              document.querySelector('.newText').style.display = 'flex';
          }

          // <!-- Скрипт для раскрывающегося списка филиалов и кнопки "Свернуть"  -->
            document.querySelector(".menu__list").addEventListener("click", function (event) {
              if (event.target.classList.contains("menu__items")) {
                event.preventDefault();

                let menuItems = event.target;
                let menuItem = menuItems.nextElementSibling;

                while (menuItem && menuItem.tagName !== "UL") {
                  menuItem = menuItem.nextElementSibling;
                }

                if (menuItem) {
                  menuItem.classList.toggle("active");
                }

                menuItems.classList.toggle("menu__items-down");

                let menuState = {};
                document.querySelectorAll(".menu__item").forEach(subMenuItem => {
                  let key = subMenuItem.parentNode.querySelector(".menu__items").textContent.trim();
                  menuState[key] = subMenuItem.classList.contains("active");
                });

                localStorage.setItem('menuState', JSON.stringify(menuState));
              }
            });

            document.addEventListener("DOMContentLoaded", function () {
              let savedState = localStorage.getItem('menuState');
              if (savedState) {
                let menuState = JSON.parse(savedState);
                Object.keys(menuState).forEach(key => {
                  let subMenuItem = Array.from(document.querySelectorAll(".menu__item")).find(item => {
                    let menuItemsText = item.parentNode.querySelector(".menu__items").textContent.trim();
                    return menuItemsText === key;
                  });

                  if (subMenuItem) {
                    subMenuItem.classList.toggle("active", menuState[key]);
                    subMenuItem.parentNode.querySelector(".menu__items").classList.toggle("menu__items-down", menuState[key]);
                  }
                });
              }
            });

            document.getElementById("toggleButton").addEventListener("click", function () {
              let allMenuItems = document.querySelectorAll(".menu__item");

              // Свернуть все элементы
              allMenuItems.forEach(item => {
                item.classList.remove("active");
              });

              document.querySelectorAll(".menu__items").forEach(menuItems => {
                menuItems.classList.remove("menu__items-down");
              });

              // Сохранить состояние
              localStorage.setItem('menuState', false);
            });
          </script>

        </div>

        <!-- Таблица с пользователями телефонного справочника и бутсраповский класс с колонками-->
        <div class="row col-sm-9">
          <div class='items_table'>
            <table class='table table-bordered table-hover'>
            <tr>
              <th>ФИО</th>
              <th>Должность</th>
              <th>Префикс</th>
              <th>Внутренний номер</th>
            </tr>      
            
            {% for item in items %}
              <TR data-bs-toggle="modal" data-bs-target="#modal_{{ item.ID }}"  style="cursor: pointer">
                <TD class='table_name'>
                <div class="container text-center">
                  <div class="row row-cols-2" style="align-items: center;">
                    <div class="col-sm-4"><img class="miniature_photo" src="{{ url_for('static', path='/content/no_avatar.jpg') }}" width="70" height="70" style="border-radius: 5px"/></div>
                    <div class="col-sm-8 thr__name">{{item.FullNameRus}}</div>
                  </div>
                </div>
                </TD>
                <TD class='table_job_title'>{{item.PositionTitle}}</TD>
                <TD class='table_prefix'>{{item.ExtNumID}}</TD>
                <TD class='table_phone_code'>{{item.ExtNumID}}</TD>
              </TR>
              
            <!-- Модальное окно -->
            <div class="modal fade" id="modal_{{ item.ID }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                  <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Информация о сотруднике</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
                  </div>
                  <div class="modal-body">
                  <div class="container text-center">
                    <div class='row'>
                        <div class='col-md-auto'>
                          <img class="no_avatar" src="{{ url_for('static',  path='/content/no_avatar.jpg') }}" alt="Нет фото" width="125" height="125" style="border-radius: 5px"/>
                        </div>
                          <div class='col'>
                            <div class='row' id='name'>
                              <div class='name'>
                              {{item.FullNameRus}}
                              </div>
                            </div>
                    <div class='row'>
                      <div class='col'>
                        <div class='job_title' style= "margin-bottom: 10px; padding-bottom: 5px">
                        {{item.PositionTitle}}
                        </div>
                      </div>
                    </div>
                    
                  <div class='row row-cols-2'>
                    <div class='col'>
                        <div class='organization' style="text-align: left; font-size: 13px;">
                          Организация
                      </div>
                    </div>
                    <div class='col'>
                        <div class='organization_value' style="text-align: right; font-size: 13px;">
                          {{item.OrganizationName}}
                      </div>
                    </div>
                  </div>
                  
                  <div class='row row-cols-2'>
                    <div class='col'>
                        <div class='department' style="text-align: left; font-size: 13px;">
                          Отдел
                      </div>
                    </div>
                    <div class='col'>
                        <div class='department_value' style="text-align: right; font-size: 13px;">
                          {{item.DepartmentName}}
                      </div>
                    </div>
                  </div>               
                  
                    <div class='row row-cols-2'>
                    <div class='col'>
                        <div class='phone' style="text-align: left; font-size: 13px;">
                          Телефон
                      </div>
                    </div>
                    <div class='col'>
                        <div class='phone_value' style="text-align: right; font-size: 13px;">
                          {{item.ExtNumID}}
                      </div>
                    </div>
                  </div>
                  
                  <div class='row row-cols-2'>
                    <div class='col'>
                        <div class='prefix' style="text-align: left; font-size: 13px;">
                          Префикс
                      </div>
                    </div>
                    <div class='col'>
                        <div class='prefix_value' style="text-align: right; font-size: 13px;">
                          {{item.ExtNumID}}
                      </div>
                    </div>
                  </div>
                  
                  <div class='row row-cols-2'>
                    <div class='col'>
                        <div class='phone_code' style="text-align: left; font-size: 13px;">
                          Внутренний номер
                      </div>
                    </div>
                    <div class='col'>
                        <div class='phone_code_value' style="text-align: right; font-size: 13px;">
                          {{item.ExtNumID}}
                      </div>
                    </div>
                  </div>
                  
                  <div class='row row-cols-2'>
                    <div class='col'>
                        <div class='mobile' style="text-align: left; font-size: 13px;">
                          Мобильный
                      </div>
                    </div>
                    <div class='col'>
                        <div class='mobile_value' style="text-align: right; font-size: 13px;">
                          {{item.MobileNumberCorp}}
                      </div>
                    </div>
                  </div>
                  
                  <div class='row row-cols-2'>
                    <div class='col'>
                        <div id='email' style="text-align: left; font-size: 13px;">
                          Email
                      </div>
                    </div>
                    <div class='col'>
                        <div id='email_value' style="text-align: right; font-size: 13px; color:#0199ff;">
                          <a class="email__adress" href="mailto:{{item.Email}}">{{item.Email}}</a>
                      </div>
                    </div>
                  </div>
                  
                    <div class='row row-cols-2'>
                    <div class='col'>
                        <div id='workplace' style="text-align: left; font-size: 13px;">
                          Рабочее место
                      </div>
                    </div>
                    <div class='col'>
                        <div id='workplace_value' style="text-align: right; font-size: 13px;">
                          {{item.WorkPlace}}
                      </div>
                    </div>
                  </div>
                  
                  <div class='row row-cols-2'>
                    <div class='col'>
                        <div id='address' style="text-align: left; font-size: 13px;">
                          Адрес
                      </div>
                    </div>
                    <div class='col'>
                        <div id='address_value' style="text-align: right; font-size: 13px;">
                          {{item.ID}}
                      </div>
                    </div>
                  </div>
                  
                  <div class='row row-cols-2'>
                    <div class='col'>
                        <div id='phonebook_id' style="text-align: left; font-size: 13px;">
                          ID телефонного справочника
                      </div>
                    </div>
                    <div class='col'>
                        <div id='phonebook_id_value' style="text-align: right; font-size: 13px;">
                          {{item.ID}}
                      </div>
                    </div>
                  </div>
                  
                  <div class='row row-cols-2'>
                    <div class='col'>
                        <div id='phonebook_id' style="text-align: left; font-size: 13px;">
                          Приоритет
                      </div>
                    </div>
                    <div class='col'>
                        <div id='phonebook_id_value' style="text-align: right; font-size: 13px;">
                          {{item.Order}}
                      </div>
                    </div>
                  </div>
                  
                    </div>
                  
                  </div>
                  

                  <div class='row'>
                    <div class='structure' style='text-align: left; margin-top: 20px; font-weight: bold; border-bottom-color: rgba(119, 123, 125, 0.5); border-bottom: solid 1px; padding-bottom: 5px; margin-bottom: 10px'>
                      Оргструктура сотрудника
                    </div>
                    <div class='col-sm-10' style='text-align: left;'>
                      <div class=name_org style='font-size: 14px; font-weight: bold;'>{{item.FullNameRus}}</div>
                      <div class=department_org style='font-size: 12px; font-weight: bold;'><a class="department" href='?page=1&search_text={{ search_text }}&search_filter={{ search_filter }}&department={{ item.department }}&company={{ item.company }}'>{{ item.department }}</a></div>
                      <div class=job_title_org style='font-size: 12px; margin-bottom: 10px'>{{item.PositionTitle}}</div>
                    </div>
                      <div class='col'>
                    </div>
                  </div>
                  
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          <!-- Скрипт модального окна, появление надписи при нажатии на отдел внутри модального окна -->
          <script>
            document.querySelectorAll('.department').forEach((item) => {
              stroke = [];
              item.addEventListener('click', (e) => {
                document.querySelectorAll('.menu__item > li > a').forEach((subitem) =>{
                  if(subitem.textContent === item.textContent)
                  {
                    subitem.click();
                  }
                })
                document.querySelectorAll('.menu__item > li > span > a').forEach((subitem)=>{
                  if(subitem.textContent === item.textContent)
                  {
                    subitem.click();
                  }
                })
                document.querySelectorAll('.menu__item > span > a').forEach((subitem)=>{
                  if(subitem.textContent === item.textContent)
                  {
                    subitem.click();
                  }
                })
              })
              
            })
          </script>
            </table>
          </div>
        </div>
      </div>

    </div>

      </div>

  <!-- Подвал сайта -->
  <div class="border-footer"></div>
      <div class="container">
          <div class="footer">
            <div class="pages_title">
              Страницы
            </div>
            <div class="pages_count">
              {% for page in pages_count %}
                {% if page == current_page %}
                <span class="page_number">
                  {{ page }}
                </span>
                {% else %}
                <span class="page_number">
                  <a href="?page={{ page }}&search_text={{ search_text }}&search_filter={{ search_filter }}&department={{ department }}" style="text-decoration: none; color: #3AB5F9">{{ page }}</a>
                </span>
                {% endif %}
              {% endfor %}
            </div>
            <div class="btn__toggle hidden">
              <button type="button" class="on">on</button>
              <button type="button" class="of">off</button>
            </div>
          </div>
      </div>
  <!-- Скрипт для Сидельникова -->
      <script>
      document.querySelector('.header-title-h1').addEventListener('click', function(){
        document.querySelector('.btn__toggle').classList.remove('hidden')
      })

    document.querySelector('.on').addEventListener('click', function(){
        localStorage.setItem('myTexttt', document.querySelector('body').classList.add('sid'));
        localStorage.getItem('myTexttt');
        document.querySelector('body').classList.add('sid')
    })

    document.querySelector('.of').addEventListener('click', function() {
      document.querySelector('body').classList.remove('sid')
      localStorage.removeItem('myTexttt');
    })

    if(localStorage.getItem('myTexttt') !== null)
  {
    document.querySelector('body').classList.add('sid')
  }
      </script>

    <!-- Скрипт Бутстрапа -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

    <!-- Скрипт подсказка при наведении на инпут-->
      <script>
      // после загрузки страницы
      $(function(){
      // инициализации подсказок для всех элементов на странице, имеющих атрибут data-toggle="tooltip"
      $('[data-toggle="tooltip"]').tooltip();
      });
      </script>
    
    <!-- Скрипт для Курсора(появляется при наведении на ссылку) -->
      <script>
      document.addEventListener('DOMContentLoaded', () => {
        const followCursor = () => { // объявляем функцию followCursor
          const el = document.querySelector('.follow-cursor') // ищем элемент, который будет следовать за курсором
      
          window.addEventListener('mousemove', e => { // при движении курсора
            const target = e.target // определяем, где находится курсор
            if (!target) return
      
            if (target.closest('.page_number')) { // если курсор наведён на ссылку
              el.classList.add('follow-cursor_active') // элементу добавляем активный класс
            } else { // иначе
              el.classList.remove('follow-cursor_active') // удаляем активный класс
            }
      
            el.style.left = e.pageX + 'px' // задаём элементу позиционирование слева
            el.style.top = e.pageY + 'px' // задаём элементу позиционирование сверху
          })
        }
      
        followCursor() // вызываем функцию followCursor
      
      })
      document.querySelector(".input").addEventListener("click", function() {
        this.removeAttribute("title");
      });
      </script>
      <!-- Скрипт для копирования EMAIL адресов -->
      <script>
          document.querySelector('.container__icon').addEventListener('click', function(e){
            let emails = document.querySelectorAll('.email__adress');
            let emailText = '';
            emails.forEach((email) => {
              emailText += email.textContent + '\n';
            })
          navigator.clipboard.writeText(emailText).catch(function(error) {
              console.error('Unable to copy to clipboard', error);
          });
              })
              
      </script>
  </body>
</html>